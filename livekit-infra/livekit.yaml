# =============================================================================
# LiveKit SFU Server - Production Configuration (Single-Node POC)
# ICE over TCP + TURN/TLS (Zero UDP - Corporate VPN / Firewall Compatible)
# =============================================================================
#
# Exposed Ports (TCP only):
#   7880/tcp  - WebSocket signaling (put behind reverse proxy with TLS in prod)
#   7881/tcp  - ICE over TCP (MUST be exposed directly, NOT behind L7 proxy)
#   5349/tcp  - TURN/TLS (encrypted relay, looks like HTTPS to firewalls)
#
# =============================================================================

port: 7880
bind: 0.0.0.0
log_level: info

# -----------------------------------------------------------------------------
# RTC - TCP Only Configuration
# -----------------------------------------------------------------------------
rtc:
  # ICE over TCP - primary media transport when UDP is blocked
  # This port CANNOT sit behind a load balancer or TLS terminator
  tcp_port: 7881

  # Collapse UDP range to disable UDP media entirely
  port_range_start: 50000
  port_range_end: 50000

  # Private infra: set to false since no NAT / public IP discovery needed
  # The server and clients are on the same private network
  # If you ever move to a public cloud VM, change to true
  use_external_ip: false

  # Set this to your server's private IP (reachable by all clients)
  # For Docker on the same host: 127.0.0.1 or the host's LAN IP
  node_ip: 0.0.0.0

  # Automatic TCP fallback when UDP fails
  allow_tcp_fallback: true

  # NO external STUN servers needed on private infrastructure:
  # - STUN is used to discover the server's public IP via an external service
  # - On private infra, there's no NAT to traverse and no public IP to discover
  # - The server IP is known and set via node_ip above
  # - Removes dependency on external internet (Google servers)
  #
  # If you later deploy on a public cloud VM behind NAT, uncomment these:
  # stun_servers:
  #   - stun.l.google.com:19302
  #   - stun1.l.google.com:19302

# -----------------------------------------------------------------------------
# TURN Server - TLS Encrypted Relay (Built-in)
# This is critical for corporate firewalls that block non-443 traffic
# Clients that can't reach 7881 will relay through TURN/TLS on 5349
# -----------------------------------------------------------------------------
turn:
  enabled: true
  # MUST match TLS certificate CN/SAN
  domain: turn.example.com
  # Port for TURN/TLS connections
  # Use 443 if nothing else occupies it (maximum firewall compat)
  # Use 5349 if a reverse proxy (Caddy/Nginx) already uses 443
  tls_port: 5349
  # TLS certificates (mounted into container)
  cert_file: /etc/ssl/turn/fullchain.pem
  key_file: /etc/ssl/turn/privkey.pem

# -----------------------------------------------------------------------------
# API Keys
# Generate: openssl rand -hex 16 (key), openssl rand -hex 32 (secret)
# These MUST match what your backend uses for token generation
# -----------------------------------------------------------------------------
keys:
  # <API_KEY>: <API_SECRET>
  APIKeyChangeMe: APISecretChangeMe

# -----------------------------------------------------------------------------
# Redis - NOT needed for single-node POC
# LiveKit works fine without Redis on a single instance.
# Redis is only required when you scale to multiple LiveKit nodes
# so they can share room state.
#
# To enable later for multi-node:
# redis:
#   address: redis:6379
#   password: your-redis-password
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Room Defaults
# -----------------------------------------------------------------------------
room:
  empty_timeout: 300
  max_participants: 50

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
logging:
  json: true

# -----------------------------------------------------------------------------
# Resource Limits
# -----------------------------------------------------------------------------
limit:
  num_tracks: 20
  bytes_per_sec: 10000000
